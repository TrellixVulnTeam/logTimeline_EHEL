<html>
<head>

<script src="papaparse.min.js"></script>
<script src="canvasjs.min.js"></script>
<script src="jquery-3.3.1.js"></script>
<script src="moment.js"></script>
<script src="moment-with-locales.js"></script>


<script>
window.onload = function () {
    $("#csv-file").change(handleFile);
    
}

function handleFile(evt){
    var file = evt.target.files[0];
    var timeline_data = new Array();
    Papa.parse(file, {
        header: true,
		skipEmptyLines: true,
        dynamicTyping: true,
        complete: function(results) {
        timeline_data = results['data'];
        console.log("got file");
        console.log(timeline_data);
        throwChart(timeline_data);
		throwTable(timeline_data);
	}
    });
    
    
}

function throwTable(timeline_data){

	var obj = timeline_data;

	var tbody = document.getElementById('tbody');

	for (var i = 0; i < obj.length; i++) {
    var tr = "<tr>";

    tr += "<td>" + moment(obj[i].x).format("YYYY MMM DD HH:mm:ss.SSS") + "</td>" + "<td>" + obj[i].z.toString() + "</td></tr>";

    tbody.innerHTML += tr;
}
}

function throwChart(TimelineData){
    var chartData = TimelineData;
    var chart = new CanvasJS.Chart("chartContainer", {
	animationEnabled: true,
	zoomEnabled: true,
	title:{
		text: "Timeline"
	},
	subtitles:[
		{
			text: "1-Video",
			
			horizontalAlign: "left",
			fontStyle: "normal",
			fontColor: "blue",
			fontFamily: "arial",
			
		},
		{
			text: "2-Notifications",
			
			horizontalAlign: "left",
			fontStyle: "normal",
			fontColor: "blue",
			fontFamily: "arial",
			
		},
		{
			text: "3-Settings",
			
			horizontalAlign: "left",
			fontStyle: "normal",
			fontColor: "blue",
			fontFamily: "arial",
			
		},
		{
			text: "4-Keypresses",
			
			horizontalAlign: "left",
			fontStyle: "normal",
			fontColor: "blue",
			fontFamily: "arial",
			
		}
	
		],
	axisX: {
		title:"Time",
		labelAngle: -30
	},
	axisY:{
		title: "Timelines"
	},
	data: [{
		type: "scatter",
		
		color: "red",
		toolTipContent: "{z} ",
		name: "Timeline",
        showInLegend: true,
        xValueType: "dateTime",
		dataPoints: chartData,
		
	}
	]
});
chart.render();

}

</script>
</head>
<body>
<input type="file" id="csv-file" name="files"/>
<div id="chartContainer" style="height: 370px; width: 100%;">
</div>


<div style="overflow-y: scroll;">

	
<table border="1", rules="all", cellspacing="40", cellpadding="10">

<tbody id="tbody">
</tbody>

</table>
</div>
</body>
</html>